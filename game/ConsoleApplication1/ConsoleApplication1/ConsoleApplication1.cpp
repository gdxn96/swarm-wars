//////////////////////////////////////////////////////////// 
// Headers 
//////////////////////////////////////////////////////////// 
#include "stdafx.h" 
#ifdef _DEBUG 
#pragma comment(lib,"sfml-graphics-d.lib") 
#pragma comment(lib,"sfml-audio-d.lib") 
#pragma comment(lib,"sfml-system-d.lib") 
#pragma comment(lib,"sfml-window-d.lib") 
#pragma comment(lib,"sfml-network-d.lib") 
#else 
#pragma comment(lib,"sfml-graphics.lib") 
#pragma comment(lib,"sfml-audio.lib") 
#pragma comment(lib,"sfml-system.lib") 
#pragma comment(lib,"sfml-window.lib") 
#pragma comment(lib,"sfml-network.lib") 
#endif 
#pragma comment(lib,"opengl32.lib") 
#pragma comment(lib,"glu32.lib") 

#include "SFML/Graphics.hpp" 
#include "SFML/OpenGL.hpp" 
#include <iostream> 

#include "SceneMgr.h"
#include "GameScene.h"
#include "MainMenuScene.h"
#include "SplashScene.h"
#include "GameConstants.h"
#include <time.h>


#define _USE_MATH_DEFINES

using namespace sf;
using namespace std;


////////////////////////////////////////////////////////////
///Entrypoint of application 
//////////////////////////////////////////////////////////// Don't edit this file, edit the individual scene files (George)
//   ____          U  ___ u      _   _          _____      
//  |  _"\          \/"_ \/     | \ |"|        |_ " _|     
// /| | | |         | | | |    <|  \| |>         | |       
// U| |_| |\    .-,_| |_| |    U| |\  |u        /| |\      
//  |____/ u     \_)-\___/      |_| \_|        u |_|U      
//   |||_             \\        ||   \\,-.     _// \\_     
//  (__)_)           (__)       (_")  (_/     (__) (__)    
// U _____ u      ____                          _____      
// \| ___"|/     |  _"\           ___          |_ " _|     
//  |  _|"      /| | | |         |_"_|           | |       
//  | |___      U| |_| |\         | |           /| |\      
//  |_____|      |____/ u       U/| |\u        u |_|U      
//  <<   >>       |||_       .-,_|___|_,-.     _// \\_     
// (__) (__)     (__)_)       \_)-' '-(_/     (__) (__) 
////////////////////////////////////////////////////////////


int main()
{
	srand(time(NULL));
	// Create the main window 
	sf::RenderWindow window(sf::VideoMode(GameConstants::WINDOW_SIZE.x, GameConstants::WINDOW_SIZE.y, 32), "Swarm-wars");
	window.setFramerateLimit(30);


	// create scenes
	GameScene game = GameScene();
	SplashScene splash = SplashScene();
	MainMenuScene menu = MainMenuScene();

	//add scenes to sceneMgr
	SceneManager::getInstance()->addScene(&game);
	SceneManager::getInstance()->addScene(&splash);
	SceneManager::getInstance()->addScene(&menu);

	//below is how to switch to scenes
	/*SceneManager::getInstance()->switchTo(Scenes::GAME);
	SceneManager::getInstance()->switchTo(Scenes::MAINMENU);
	SceneManager::getInstance()->switchTo(Scenes::SPLASH);*/

	//splash is first
	SceneManager::getInstance()->switchTo(Scenes::SPLASH);
	
	sf::Clock deltaClock; // used to calculate dt
	float dt = 0; // floating point dt as seconds

	

	// Start game loop 
	while (window.isOpen())
	{
		// Process events 
		sf::Event Event;
		while (window.pollEvent(Event))
		{
			// Close window : exit 
			if (Event.type == sf::Event::Closed)
				window.close();

			// Escape key : exit 
			if ((Event.type == sf::Event::KeyPressed) && (Event.key.code == sf::Keyboard::Escape))
				window.close();

		}
		InputHandler::getInstance()->update();

		SceneManager::getInstance()->update(dt);
		
		//prepare frame
		window.clear(sf::Color(230,155,131));

		//draw frame items
		SceneManager::getInstance()->draw(window);

		// Finally, display rendered frame on screen 
		window.display();

		dt = deltaClock.restart().asSeconds();

		

	} //loop back for next frame

	return EXIT_SUCCESS;
}